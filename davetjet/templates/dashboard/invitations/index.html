{% extends '../dashboard-base.html' %} {% load static %} {% block content %}
<section class="overview scrollable">
  <div class="overview-top">
    <div>
      <h1>Davetiyeler ({{ projects|length }} adet listelendi)</h1>
      <p>
        Bu ekrandan davetiyellerinize göz atabilir ve yenilerini
        oluşturabilirsiniz.
      </p>
    </div>
    <a href="{% url 'core:create-invitation' %}" class="btn btn--create">
      <i class="fa-solid fa-plus"></i>
    </a>
  </div>

  <!-- Bottom Section -->
  <div class="bottom-widgets">
{% for project in projects %}
  {% for invitation in project.invitations.all %}
    <div class="card invite-preview"
         data-href="{% url 'core:edit-invitation' invitation.id %}"
         role="link" tabindex="0" aria-label="{{ invitation.name }} davetiyesini düzenle">
      <h3>{{ invitation.name }}</h3>

      <div class="content">
          <div class="inv-preview-frame" data-base-w="390" data-max-h="140">
            <div class="inv-preview-canvas">
              {% include invitation.preview_template_path with invitation=invitation only %}
            </div>
          </div>
        <div class="actions btn-row">
  <button type="button"
          class="btn btn--soft btn--sm btn--pill export-pdf"
          data-id="{{ invitation.id }}" data-stop>
    PDF Dışa Aktar
  </button>

  <button type="button"
          class="btn btn--outlined btn--sm btn--pill copy-link-btn"
          data-url="{{ invitation.secure_invite_link }}" data-stop>
    Bağlantıyı Kopyala
  </button>

  <a class="btn btn--primary btn--sm btn--pill"
     href="{% url 'core:edit-invitation' invitation.id %}" data-stop>
    Düzenle
  </a>
</div>

      </div>
    </div>
  {% endfor %}
{% endfor %}

  </div>
</section>
{% endblock %}

{% block end_js %}
<script>
const copyLinkBtns = document.querySelectorAll('.copy-link-btn')

copyLinkBtns.forEach(btn => {
  btn.addEventListener('click', (e) => {
    e.preventDefault()
    const url = btn.getAttribute('data-url')
    navigator.clipboard.writeText(url).then(() => {
      alert('Bağlantı kopyalandı!')
    })
    .catch(err => {
      console.error('Bağlantı kopyalanamadı: ', err)
      alert('Bağlantı kopyalanamadı. Lütfen manuel olarak kopyalayın.')
    })
  })
})
</script>
{% endblock %}