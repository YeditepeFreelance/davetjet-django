{% extends '../dashboard-base.html' %} {% load static %} {% block content %}
<section class="overview scrollable">
  <div class="overview-top">
    <div>
      <h1>Davetiyeler ({{ projects|length }} adet listelendi)</h1>
      <p>
        Bu ekrandan davetiyellerinize göz atabilir ve yenilerini
        oluşturabilirsiniz.
      </p>
    </div>
    <a href="{% url 'core:create-invitation' %}" class="btn btn--create">
      <i class="fa-solid fa-plus"></i>
    </a>
  </div>

  <!-- Bottom Section -->
  <div class="bottom-widgets">
    {% for project in projects %}
    {% for invitation in project.invitations.all %}
    <a href="{% url 'core:edit-invitation' invitation.id %}">
      <div class="card invite-preview">
        <h3>{{ invitation.name }} ({{ project.name }})</h3>
        <div class="content">
          <img
            src="{% static 'images/invitation-sample.png' %}"
            alt="Davetiye"
          />
          <div class="actions">
            <a>PDF Dışa Aktar</a>
            <a class="copy-link-btn" href="{{ invitation.secure_invite_link }}" data-url="{{ invitation.secure_invite_link }}">Bağlantıyı Kopyala (Şifresiz Giriş)</a>
            <a>Düzenle</a>
            <p>Toplam: {{ project.recipients.count }}</p>
            <p>Oluşturulma Tarihi: {{ invitation.created_at }}</p>
            <p>Son Güncelleme: {{ invitation.updated_at }}</p>
          </div>
        </div>
      </div>
    </a>
    {% endfor %}
    {% endfor %}
  </div>
</section>
{% endblock %}

{% block end_js %}
<script>
const copyLinkBtns = document.querySelectorAll('.copy-link-btn')

copyLinkBtns.forEach(btn => {
  btn.addEventListener('click', (e) => {
    e.preventDefault()
    const url = btn.getAttribute('data-url')
    navigator.clipboard.writeText(url).then(() => {
      alert('Bağlantı kopyalandı!')
    })
    .catch(err => {
      console.error('Bağlantı kopyalanamadı: ', err)
      alert('Bağlantı kopyalanamadı. Lütfen manuel olarak kopyalayın.')
    })
  })
})
</script>
{% endblock %}